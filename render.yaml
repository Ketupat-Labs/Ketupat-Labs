# Render Blueprint for CompuPlay Laravel Application
# This file defines all services needed to deploy the application

services:
  # Main Laravel Application (Web Service)
  - type: web
    name: compuplay-app
    runtime: docker
    plan: starter # Change to 'standard' or higher for production
    region: singapore # Change to your preferred region
    dockerfilePath: ./Dockerfile
    dockerContext: .
    envVars:
      - key: APP_NAME
        value: CompuPlay
      - key: APP_ENV
        value: production
      - key: APP_KEY
        sync: false # Will be set manually in Render dashboard
      - key: APP_DEBUG
        value: false
      - key: APP_URL
        sync: false # Will be auto-generated by Render
      
      # Database (Aiven MySQL)
      - key: DB_CONNECTION
        value: mysql
      - key: DB_HOST
        sync: false # Set in Render dashboard
      - key: DB_PORT
        value: 11423
      - key: DB_DATABASE
        value: compuplay
      - key: DB_USERNAME
        sync: false # Set in Render dashboard (secret)
      - key: DB_PASSWORD
        sync: false # Set in Render dashboard (secret)
      
      # Redis (Render Redis)
      - key: REDIS_HOST
        fromService:
          type: redis
          name: compuplay-redis
          property: host
      - key: REDIS_PORT
        fromService:
          type: redis
          name: compuplay-redis
          property: port
      - key: REDIS_PASSWORD
        value: null
      
      # Cache & Session
      - key: CACHE_DRIVER
        value: redis
      - key: SESSION_DRIVER
        value: redis
      - key: QUEUE_CONNECTION
        value: sync # Change to 'redis' if you add a worker
      
      # Broadcasting (Laravel Reverb)
      - key: BROADCAST_CONNECTION
        value: reverb
      - key: REVERB_APP_ID
        value: compuplay
      - key: REVERB_APP_KEY
        sync: false # Set in Render dashboard
      - key: REVERB_APP_SECRET
        sync: false # Set in Render dashboard (secret)
      - key: REVERB_HOST
        value: localhost
      - key: REVERB_PORT
        value: 8080
      - key: REVERB_SCHEME
        value: http
      
      # Mail Configuration
      - key: MAIL_MAILER
        value: smtp
      - key: MAIL_HOST
        value: smtp.gmail.com
      - key: MAIL_PORT
        value: 587
      - key: MAIL_USERNAME
        sync: false # Set in Render dashboard
      - key: MAIL_PASSWORD
        sync: false # Set in Render dashboard (secret - App Password)
      - key: MAIL_ENCRYPTION
        value: tls
      - key: MAIL_FROM_ADDRESS
        value: ketupatlabs@gmail.com
      - key: MAIL_FROM_NAME
        value: Ketupat Labs
      - key: SENDGRID_API_KEY
        sync: false # Set in Render dashboard (starts with SG.)
    
    healthCheckPath: /
    autoDeploy: true # Auto-deploy on git push
    
  # Redis Cache Service
  - type: redis
    name: compuplay-redis
    plan: starter # Free tier available
    region: singapore # Same region as web service
    ipAllowList: [] # Empty = allow all Render services
    maxmemoryPolicy: allkeys-lru

# Optional: Background Worker (uncomment if needed)
# - type: worker
#   name: compuplay-worker
#   runtime: docker
#   dockerfilePath: ./Dockerfile
#   dockerContext: .
#   dockerCommand: php artisan queue:work --sleep=3 --tries=3
#   envVars:
#     # Copy all envVars from web service above
#   autoDeploy: true
